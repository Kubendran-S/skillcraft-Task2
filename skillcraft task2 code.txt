# Task-2

# Simplified Gradio version
!pip install gradio scikit-learn pandas numpy matplotlib

import gradio as gr
import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
from sklearn.cluster import KMeans
from sklearn.preprocessing import StandardScaler

# Load data
def load_data():
    data = {
        'Age': [19,21,20,23,31,22,35,23,64,30,67,35,58,24,37,22,35,20,52,35,35,25,46,31,54,29,45,35,40,23,60,21,53,18,49,21,42,30,36,20,65,24,48,31,49,24,50,27,29,31,49,33,31,59,50,47,51,69,27,53,70,19,67,54,63,18,43,68,19,32,70,47,60,60,59,26,45,40,23,49,57,38,67,46,21,48,55,22,34,50,68,18,48,40,32,24,47,27,48,20,23,49,67,26,49,21,66,54,68,66,65,19,38,19,18,19,63,49,51,50,27,38,40,39,23,31,43,40,59,38,47,39,25,31,20,29,44,32,19,35,57,32,28,32,25,28,48,32,34,34,43,39,44,38,47,27,37,30,34,30,56,29,19,31,50,36,42,33,36,32,40,28,36,36,52,30,58,27,59,35,37,32,46,29,41,30,54,28,41,36,34,32,33,38,47,35,45,32,32,30],
        'Income': [15,15,16,16,17,17,18,18,19,19,19,19,20,20,20,20,21,21,23,23,24,24,25,25,28,28,28,28,29,29,30,30,33,33,33,33,34,34,37,37,38,38,39,39,39,39,40,40,40,40,42,42,43,43,43,43,44,44,46,46,46,46,47,47,48,48,48,48,48,48,49,49,50,50,54,54,54,54,54,54,54,54,54,54,54,54,57,57,58,58,59,59,60,60,60,60,60,60,61,61,62,62,62,62,62,62,63,63,63,63,63,63,64,64,65,65,65,65,67,67,67,67,69,69,70,70,71,71,71,71,71,71,72,72,73,73,73,73,74,74,75,75,76,76,77,77,77,77,78,78,78,78,78,78,78,78,78,78,78,78,79,79,81,81,85,85,86,86,87,87,87,87,87,87,88,88,88,88,93,93,97,97,98,98,99,99,101,101,103,103,103,103,113,113,120,120,126,126,137,137],
        'Spending': [39,81,6,77,40,76,6,94,3,72,14,99,15,77,13,79,35,66,29,98,35,73,5,73,14,82,32,61,31,87,4,73,4,92,14,81,17,73,26,75,35,92,36,61,28,65,55,47,42,42,52,60,54,60,45,41,50,46,51,46,56,55,52,59,51,59,50,48,59,47,55,42,49,56,47,54,53,48,52,42,51,55,41,44,57,46,58,55,60,46,55,41,49,40,42,52,47,50,42,49,41,48,59,55,56,42,50,46,43,48,52,54,42,46,48,50,43,59,43,57,56,40,58,91,29,77,35,95,11,75,9,75,34,71,5,88,7,73,10,72,5,93,40,87,12,97,36,74,22,90,17,88,20,76,16,89,1,78,1,73,35,83,5,93,26,75,20,95,27,63,13,75,10,92,13,86,15,69,14,90,32,86,15,88,39,97,24,68,17,85,23,69,8,91,16,79,28,74,18,83]
    }
    return pd.DataFrame(data)

def analyze_clusters(n_clusters=5):
    df = load_data()
    X = df[['Age', 'Income', 'Spending']].values
    scaler = StandardScaler()
    X_scaled = scaler.fit_transform(X)

    kmeans = KMeans(n_clusters=n_clusters, random_state=42, n_init=10)
    labels = kmeans.fit_predict(X_scaled)

    # Create plot
    fig, ax = plt.subplots(figsize=(10, 6))
    scatter = ax.scatter(df['Income'], df['Spending'], c=labels, cmap='viridis', alpha=0.7)
    ax.set_xlabel('Annual Income (k$)')
    ax.set_ylabel('Spending Score')
    ax.set_title(f'Customer Segments ({n_clusters} clusters)')
    plt.colorbar(scatter, ax=ax, label='Cluster')
    plt.tight_layout()

    # Create report
    report = f"## Analysis Results\n"
    report += f"**Clusters:** {n_clusters}\n"
    report += f"**Total customers:** {len(df)}\n\n"

    for i in range(n_clusters):
        cluster_data = df[labels == i]
        report += f"**Cluster {i}:** {len(cluster_data)} customers\n"
        report += f"- Avg Income: ${cluster_data['Income'].mean():.1f}k\n"
        report += f"- Avg Spending: {cluster_data['Spending'].mean():.1f}\n"
        report += f"- Avg Age: {cluster_data['Age'].mean():.1f} years\n\n"

    return fig, report

# Create interface
with gr.Blocks() as demo:
    gr.Markdown("# üõçÔ∏è Mall Customer Segmentation")

    with gr.Row():
        n_clusters = gr.Slider(2, 8, value=5, label="Number of Clusters")
        analyze_btn = gr.Button("Analyze")

    with gr.Row():
        plot_output = gr.Plot()
        report_output = gr.Markdown()

    analyze_btn.click(analyze_clusters, inputs=n_clusters, outputs=[plot_output, report_output])

# Launch
demo.launch(share=True)